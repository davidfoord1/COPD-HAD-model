---
title: "model-notes"
format: html
editor: source
---

## What are the patient characteristics that predict worsening depression/anxiety in COPD patients? 

-   Dataset of 101 [Chronic obstructive pulmonary disease](https://www.nhs.uk/conditions/chronic-obstructive-pulmonary-disease-copd/) COPD patients. 

-   The HAD variable is the score from the Hospital Anxiety and Depression scale.

-   HADS score ranges from 0 to 21


## Choosing predictor variables

-   Characteristics: Age, Gender, PackHistory, Smoking.

-   Disease: CAT, COPDSEVERITY.

-   Lung function: FEV1, FEV1PRED, FVCPRED, FVCPRED1.

-   Co-morbidities: 

## Import Dataset

```{r}
COPD <- read.csv("data/COPD_student_dataset.csv")
```


## Missing or inaccurate values

Inspecting variables with `summary()` reveals some unlikely looking ranges.

```{r}
summary(COPD[["HAD"]])
```

The HAD score should range from 0 to 21, so there's a least 1 incorrect value.

```{r}
sum(COPD[["HAD"]] > 21)
table(COPD[["HAD"]][COPD[["HAD"]] > 21])
```

In fact there are 11 values over 21. It looks as though the scale for this
actually runs from 0 to 30. I'd like to take these questions back to the
research team to confirm, but for the sake of this exercise I will just ignore
56.2 as the outlier.

```{r}
COPD[["HAD"]][COPD[["HAD"]] > 30] <- NA_integer_
```

Similarly, CAT has a clearly separated max value. CAT is the COPD assessment test and according to the [CAT user guide](https://www.catestonline.org/content/dam/global/catestonline/documents/CAT_HCP%20User%20Guide.pdf "COPD Assessment Test FAQ") is scored on a scale of 0-40.

```{r}
summary(COPD[["CAT"]])
sum(COPD[["CAT"]] > 40)
```

Since there is just the one, I will exclude it.

```{r}
COPD[["CAT"]][COPD[["CAT"]] > 40] <- NA_integer_
```


## Collinearity of predictor candidates

### Correlation in continuous variables

```{r collinear}
continuous_vars <- c("PackHistory", "CAT", "FEV1", 
                     "FEV1PRED", "FVC", "FVCPRED")
```
::: {.panel-tabset}
## Pairwise scatterplots
```{r}
pairs(COPD[, continuous_vars])
```
## Correlation Matrix

```{r}
cor(COPD[, continuous_vars])
```
:::

### Lung Function

There is strong correlation between the lung function measures FEV1, FEV1PRED,
FVC and FVCPRED, so I will seek to include only one of the four, by exploring
the individual relationships of each to HAD:

::: {.panel-tabset}
## FEV1

```{r}
FEV1_model <- lm(HAD ~ FEV1, COPD)
summary(FEV1_model)
plot(HAD ~ FEV1, COPD)
abline(FEV1_model)
```
## FEV1PRED

```{r}
FEV1PRED_model <- lm(HAD ~ FEV1PRED, COPD)
summary(FEV1PRED_model)
plot(HAD ~ FEV1PRED, COPD)
abline(FEV1PRED_model)
```

## FVC

```{r}
FVC_model <- lm(HAD ~ FVC, COPD)
summary(FVC_model)
plot(HAD ~ FVC, COPD)
abline(FVC_model)
```

## FVCPRED

```{r}
FVCPRED_model <- lm(HAD ~ FVCPRED, COPD)
summary(FVCPRED_model)
plot(HAD ~ FVCPRED, COPD)
abline(FVCPRED_model)
```
:::

They all have seem to be a slight negative predictor of HAD, but none of them
explain the variation very well. The FVCPRED model has the highest adjusted R
squared value at 0.06179.

### PackHistory and smoking

PackHistory and smoking are both about a person's smoking history. smoking is a
categorical variable with value 1 for has smoked previously and 2 for currently
smokes. PackHistory records a person’s pack years smoking, where pack years is
defined as twenty cigarettes smoked every day for one year. For this model I
will use the more detailed PackHistory variable.

### Comborbidities

There are several binary variables relating to comorbidity

```{r}
COPD$comorbid <- COPD$Diabetes == 1 | COPD$muscular == 1 | 
  COPD$hypertension == 1 | COPD$AtrialFib == 1 | COPD$IHD == 1

COPD$comorbid <- factor(COPD$comorbid)
```

## Disease measure 

CAT and COPDSEVERITY are both measures of COPD disease status. CAT is a
continuous score and COPDSEVERITY has three categories of severity. If both
variables are suitable I will select the more detailed CAT.

::: {.panel-tabset}
## CAT
```{r}
summary(COPD[["CAT"]])
summary(lm(HAD ~ CAT, COPD))
```
## COPDSEVERITY

```{r}
table(COPD[["COPDSEVERITY"]])
summary(lm(HAD ~ COPDSEVERITY, COPD))
```

:::

## Trying out the variables as predictors

That leaves us with the following candidate predictor variables to explore

- AGE
- GENDER
- CAT
- FVCPRED
- comorbid

First I want to explore the relationship of each variable indivually with the
outcome HAD.

```{r}

```

